import*as e from"@zxing/library";function t(e,t,r){var a=document.createElement("canvas"),n=a.getContext("2d");return a.width=t,a.height=r,n.drawImage(e,0,0,t,r),n.getImageData(0,0,t,r)}var r=function(e){try{if(e instanceof HTMLImageElement){try{e.decode()}catch(e){throw new DOMException("HTMLImageElement is not decodable","InvalidStateError")}return Promise.resolve(t(e,e.naturalWidth,e.naturalHeight))}if(e instanceof SVGImageElement)return Promise.resolve(t(e,640,480));if(e instanceof HTMLVideoElement){if(0===e.readyState||1===e.readyState)throw new DOMException("","InvalidStateError");return Promise.resolve(t(e,e.videoWidth,e.videoHeight))}if(e instanceof HTMLCanvasElement){var r=e.getContext("2d");return Promise.resolve(r.getImageData(0,0,e.width,e.height))}if("ImageBitmap"in window&&e instanceof ImageBitmap)return Promise.resolve(t(e,e.width,e.height));if("OffscreenCanvas"in window&&e instanceof OffscreenCanvas){var n=e.getContext("2d");return Promise.resolve(n.getImageData(0,0,e.width,e.height))}return e instanceof Blob?Promise.resolve(a(e)):e instanceof ImageData?Promise.resolve(e):Promise.resolve()}catch(e){return Promise.reject(e)}},a=function(e){try{var t=URL.createObjectURL(e),a=new Image;return a.src=t,Promise.resolve(new Promise(function(e,t){a.onload=e,a.onerror=t})).then(function(){return URL.revokeObjectURL(t),r(a)})}catch(e){return Promise.reject(e)}},n=new Map([["aztec",e.BarcodeFormat.AZTEC],["code_39",e.BarcodeFormat.CODE_39],["code_128",e.BarcodeFormat.CODE_128],["data_matrix",e.BarcodeFormat.DATA_MATRIX],["ean_8",e.BarcodeFormat.EAN_8],["ean_13",e.BarcodeFormat.EAN_13],["itf",e.BarcodeFormat.ITF],["pdf417",e.BarcodeFormat.PDF_417],["qr_code",e.BarcodeFormat.QR_CODE],["upc_a",e.BarcodeFormat.UPC_A],["upc_e",e.BarcodeFormat.UPC_E]]),o=new Map(Array.from(n).map(function(e){return[e[1],e[0]]})),i=Array.from(n.keys()),c=function(e){var t=o.get(e.getBarcodeFormat()),r=e.getText(),a=Object.freeze(e.getResultPoints().map(function(e){return{x:e.getX(),y:e.getY()}})),n=a.map(function(e){return e.x}),i=a.map(function(e){return e.y}),c=Math.min.apply(Math,n),m=Math.max.apply(Math,n),d=Math.min.apply(Math,i),s=Math.max.apply(Math,i);return{format:t,rawValue:r,cornerPoints:a,boundingBox:DOMRectReadOnly.fromRect({x:c,y:d,width:m-c,height:s-d})}},m=function(){function t(t){var r;this.reader=void 0;var a=null!=(r=null==t?void 0:t.formats)?r:i;if(0===a.length)throw new TypeError("");if(a.includes("unknown"))throw new TypeError("");var o=new Map([[e.DecodeHintType.POSSIBLE_FORMATS,a.map(function(e){return n.get(e)})]]);this.reader=new e.MultiFormatReader,this.reader.setHints(o)}return t.getSupportedFormats=function(){return Promise.resolve(i)},t.prototype.detect=function(t){try{var a=this;return Promise.resolve(r(t)).then(function(t){var r=document.createElement("canvas"),n=r.getContext("2d");r.width=t.width,r.height=t.height,n.putImageData(t,0,0);try{var o=new e.HTMLCanvasElementLuminanceSource(r),i=new e.BinaryBitmap(new e.HybridBinarizer(o)),m=a.reader.decode(i);return[c(m)]}catch(e){return console.error(e),[]}})}catch(e){return Promise.reject(e)}},t}();export default m;
//# sourceMappingURL=barcode-detector.module.js.map
